GCP Creation Steps:
Step 1: Initialize gcloud
gcloud init
Bayo's Google Credentials token: 4/0AfJohXln9aByudLVpZUtjoUjlK2YaLNqK1P9i69ZywzcwfzDAjgxRWUcG69R25ydsv53q

Create the instance template:
gcloud compute instance-templates create bayo-inst-temp-1 \
  --machine-type=e2-micro \
  --image-family=ubuntu-minimal-2204-jammy \
  --image-project=ubuntu-os-cloud \
  --boot-disk-size=30GB \
  --boot-disk-type=pd-balanced \
  --tags=http-server,https-server,lb-health-check \
  --metadata=startup-script="apt update -y && apt install -y apache2 && echo 'Bayo\'s web-server on \${HOSTNAME}' > /var/www/html/index.html" \
  #--service-account=601084348983-compute@developer.gserviceaccount.com

Create instance group and auto-scaler group:
# 1. Create Instance Group
gcloud compute instance-groups managed create bayo-inst-grp-1 \
  --base-instance-name=bayo-inst-grp-1 \
  --size=3 \
  --region=us-east4 \
  --template=bayo-inst-temp-1 \
  --named-ports=http:80

# 2. Create Instance Group Manager
gcloud beta compute instance-groups managed create bayo-inst-grp-1 \
  --base-instance-name=bayo-inst-grp-1 \
  --size=3 \
  --region=us-east4 \
  --template=bayo-inst-temp-1 \
  --named-ports=http:80 \
  --auto-healing-policies="initialDelaySec=300,healthCheck=projects/kodecloud-learning/global/healthChecks/bayo-simple-health-check" \
  #--service-account=601084348983@cloudservices.gserviceaccount.com \
  --status=isStable=true

# 3. Create Autoscaler
gcloud compute autoscalers create bayo-inst-grp-1 \
  --target=bayo-inst-grp-1 \
  --region=us-east4 \
  --autoscaling-policy="cpuUtilization.utilizationTarget=0.9,cpuUtilization.predictiveMethod=NONE,maxNumReplicas=6,coolDownPeriodSec=60,mode=ON,minNumReplicas=3"


Load balancer setup:


# 1. Create a Security Policy
gcloud compute security-policies create security-policy-for-backend-service-bayo-backend-svc \
  --description="Default security policy for: bayo-backend-svc" \
  --rules="action=allow,match='config.srcIpRanges=*',versionedExpr='SRC_IPS_V1',priority=2147483647" \
  --rules="action=throttle,description='Default rate limiting rule',match='config.srcIpRanges=*',versionedExpr='SRC_IPS_V1',priority=2147483646,rateLimitOptions=conformAction=allow,enforceOnKey=IP,exceedAction='deny(403)',rateLimitThreshold.count=500,rateLimitThreshold.intervalSec=60"

# 2. Create a Backend Service
gcloud compute backend-services create bayo-backend-svc \
  --description="bayo-backend-svc" \
  --protocol=HTTP \
  --port-name=http \
  --health-checks=bayo-simple-health-check \
  --security-policy=security-policy-for-backend-service-bayo-backend-svc \
  --enable-cdn \
  --load-balancing-scheme=EXTERNAL_MANAGED \
  --locality-lb-policy=ROUND_ROBIN \
  --timeout=30 \
  --log-config=enable=true,sample-rate=1

# 3. Set Security Policy for Backend Service
gcloud compute backend-services set-security-policy bayo-backend-svc \
  --security-policy=security-policy-for-backend-service-bayo-backend-svc

# 4. Create a URL Map
gcloud compute url-maps create bayo-load-balancer-1 \
  --default-service=bayo-backend-svc

# 5. Create a Target HTTP Proxy
gcloud compute target-http-proxies create bayo-load-balancer-1-target-proxy \
  --url-map=bayo-load-balancer-1

# 6. Create a Forwarding Rule
gcloud compute forwarding-rules create bayo-frontendip-and-port \
  --description="bayo-frontendIP-and-port" \
  --ip-version=IPV4 \
  --port-range=80 \
  --target-http-proxy=bayo-load-balancer-1-target-proxy \
  --load-balancing-scheme=EXTERNAL_MANAGED \
  --network-tier=PREMIUM \
  --region=us-east4

# 7. Set Named Ports for Instance Group
gcloud beta compute instance-groups set-named-ports bayo-inst-grp-1 \
  --named-ports="name=http,port=80" \
  --region=us-east4
